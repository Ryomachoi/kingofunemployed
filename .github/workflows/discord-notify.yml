name: Discord ì•Œë¦¼ ì „ì²´ ìë™í™” (Embed)

on:
  create:
  push:
  pull_request:
    types: [opened, synchronize, closed]
  issues:
    types: [opened, closed]
  issue_comment:
    types: [created]
  release:
    types: [published]

jobs:
  notify-discord:
    runs-on: ubuntu-latest
    steps:
      - name: Send Discord Embed
        run: |
          EVENT="${{ github.event_name }}"
          ACTION="${{ github.event.action }}"
          TIMESTAMP=$(date -u +%Y-%m-%dT%H:%M:%SZ)

          if [[ "$EVENT" == "create" && "${{ github.event.ref_type }}" == "branch" ]]; then
            BRANCH="${{ github.event.ref }}"
            USER="${{ github.actor }}"
            COLOR=3447003
            TITLE="ğŸŒ¿ ìƒˆë¡œìš´ ë¸Œëœì¹˜ ìƒì„±"
            DESCRIPTION="**ë¸Œëœì¹˜ëª…:** \`$BRANCH\`\n**ì‘ì„±ì:** $USER"

          elif [[ "$EVENT" == "push" ]]; then
            BRANCH="${{ github.ref_name }}"
            USER="${{ github.actor }}"
            MSG=$(echo "${{ github.event.head_commit.message }}" | sed ':a;N;$!ba;s/\n/\\n/g')
            COLOR=15105570
            TITLE="ğŸ“¦ ì»¤ë°‹ í‘¸ì‹œ"
            DESCRIPTION="**ë¸Œëœì¹˜:** \`$BRANCH\`\n**ì‘ì„±ì:** $USER\n**ë©”ì‹œì§€:**\n$MSG"

          elif [[ "$EVENT" == "pull_request" && "$ACTION" == "opened" ]]; then
            TITLE_TEXT="${{ github.event.pull_request.title }}"
            URL="${{ github.event.pull_request.html_url }}"
            AUTHOR="${{ github.event.pull_request.user.login }}"
            FROM="${{ github.event.pull_request.head.ref }}"
            TO="${{ github.event.pull_request.base.ref }}"
            COLOR=10181046
            TITLE="ğŸ“£ Pull Request ìƒì„±"
            DESCRIPTION="**[$TITLE_TEXT]($URL)**\n**ì‘ì„±ì:** $AUTHOR\n**ë¸Œëœì¹˜:** \`$FROM â†’ $TO\`"

          elif [[ "$EVENT" == "pull_request" && "$ACTION" == "synchronize" ]]; then
            TITLE_TEXT="${{ github.event.pull_request.title }}"
            URL="${{ github.event.pull_request.html_url }}"
            AUTHOR="${{ github.event.sender.login }}"
            COLOR=15844367
            TITLE="ğŸ”„ PRì— ì»¤ë°‹ ì¶”ê°€"
            DESCRIPTION="**[$TITLE_TEXT]($URL)**\n**ì¶”ê°€ì:** $AUTHOR"

          elif [[ "$EVENT" == "pull_request" && "$ACTION" == "closed" && "${{ github.event.pull_request.merged }}" == "true" ]]; then
            TITLE_TEXT="${{ github.event.pull_request.title }}"
            URL="${{ github.event.pull_request.html_url }}"
            AUTHOR="${{ github.event.pull_request.user.login }}"
            COLOR=3066993
            TITLE="âœ… PR ë³‘í•© ì™„ë£Œ"
            DESCRIPTION="**[$TITLE_TEXT]($URL)**\n**ë³‘í•©ì:** $AUTHOR"

          elif [[ "$EVENT" == "pull_request" && "$ACTION" == "closed" && "${{ github.event.pull_request.merged }}" != "true" ]]; then
            TITLE_TEXT="${{ github.event.pull_request.title }}"
            URL="${{ github.event.pull_request.html_url }}"
            AUTHOR="${{ github.event.pull_request.user.login }}"
            COLOR=15548997
            TITLE="âŒ PRì´ ë‹«í˜”ìŠµë‹ˆë‹¤"
            DESCRIPTION="**[$TITLE_TEXT]($URL)**\n**ë‹«ì€ ì‚¬ëŒ:** $AUTHOR"

          elif [[ "$EVENT" == "issues" && "$ACTION" == "opened" ]]; then
            TITLE_TEXT="${{ github.event.issue.title }}"
            URL="${{ github.event.issue.html_url }}"
            AUTHOR="${{ github.event.issue.user.login }}"
            COLOR=16776960
            TITLE="ğŸ“ ìƒˆë¡œìš´ ì´ìŠˆ"
            DESCRIPTION="**[$TITLE_TEXT]($URL)**\n**ì‘ì„±ì:** $AUTHOR"

          elif [[ "$EVENT" == "issues" && "$ACTION" == "closed" ]]; then
            TITLE_TEXT="${{ github.event.issue.title }}"
            URL="${{ github.event.issue.html_url }}"
            AUTHOR="${{ github.event.issue.user.login }}"
            COLOR=15548997
            TITLE="ğŸ›‘ ì´ìŠˆê°€ ë‹«í˜”ìŠµë‹ˆë‹¤"
            DESCRIPTION="**[$TITLE_TEXT]($URL)**\n**ë‹«ì€ ì‚¬ëŒ:** $AUTHOR"

          elif [[ "$EVENT" == "issue_comment" && "$ACTION" == "created" ]]; then
            AUTHOR="${{ github.event.comment.user.login }}"
            URL="${{ github.event.comment.html_url }}"
            COMMENT=$(echo "${{ github.event.comment.body }}" | sed ':a;N;$!ba;s/\n/\\n/g')
            COLOR=7506394
            TITLE="ğŸ’¬ ìƒˆ ëŒ“ê¸€"
            DESCRIPTION="**ì‘ì„±ì:** $AUTHOR\n[ëŒ“ê¸€ ë³´ëŸ¬ê°€ê¸°]($URL)\n\n**ë‚´ìš©:**\n$COMMENT"

          elif [[ "$EVENT" == "release" && "$ACTION" == "published" ]]; then
            NAME="${{ github.event.release.name }}"
            TAG="${{ github.event.release.tag_name }}"
            AUTHOR="${{ github.event.release.author.login }}"
            URL="${{ github.event.release.html_url }}"
            COLOR=5763719
            TITLE="ğŸ“¦ ë¦´ë¦¬ì¦ˆ ê²Œì‹œë¨"
            DESCRIPTION="**ì´ë¦„:** $NAME\n**íƒœê·¸:** \`$TAG\`\n**ì‘ì„±ì:** $AUTHOR\n[ë³´ëŸ¬ê°€ê¸°]($URL)"

          else
            COLOR=10038562
            TITLE="â“ ê°ì§€ë˜ì§€ ì•Šì€ ì´ë²¤íŠ¸"
            DESCRIPTION="**ì´ë²¤íŠ¸:** $EVENT\n**ì•¡ì…˜:** $ACTION"
          fi

          JSON=$(jq -n \
            --arg title "$TITLE" \
            --arg description "$DESCRIPTION" \
            --argjson color "$COLOR" \
            --arg timestamp "$TIMESTAMP" \
            '{
              "embeds": [{
                "title": $title,
                "description": $description,
                "color": $color,
                "footer": { "text": "GitHub Actions ìë™ ì•Œë¦¼" },
                "timestamp": $timestamp
              }]
            }')

          curl -H "Content-Type: application/json" \
               -X POST \
               -d "$JSON" \
               "${{ secrets.DISCORD_WEBHOOK }}"
